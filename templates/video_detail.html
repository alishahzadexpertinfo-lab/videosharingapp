{% extends "base.html" %}
{% block content %}
<article class="video-detail">
    <video controls src="{{ video.video_url }}" class="video-player"></video>
    <div class="video-detail-info">
        <h1>{{ video.title }}</h1>
        <p class="video-meta">by {{ video.username }} · {{ video.created_at[:19].replace('T', ' ') }} UTC</p>
        <p>{{ video.description }}</p>
        {% if current_user and current_user.id == video.user_id %}
            <div class="video-owner-actions">
                <a href="{{ url_for('edit_video', video_id=video.id) }}" class="btn btn-secondary">Edit</a>
                <form action="{{ url_for('delete_video', video_id=video.id) }}" method="post" onsubmit="return confirm('Delete this video?');">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        {% endif %}
    </div>
</article>

<section class="comments">
    <h2>Comments</h2>
    {% if current_user %}
        <form method="post" action="{{ url_for('add_comment', video_id=video.id) }}" class="form-card">
            <label>Add a comment
                <textarea name="text" rows="2" required></textarea>
            </label>
            <button class="btn btn-primary" type="submit">Post comment</button>
        </form>
    {% else %}
        <p><a href="{{ url_for('login') }}">Log in</a> to comment.</p>
    {% endif %}

    <div class="comment-list">
        {% for c in comments %}
            <div class="comment">
                <p class="comment-meta">
                    <strong>{{ c.username }}</strong> · {{ c.created_at[:19].replace('T', ' ') }} UTC
                </p>
                <p>{{ c.text }}</p>
                {% if current_user and current_user.id == c.user_id %}
                    <form method="post" action="{{ url_for('delete_comment', comment_id=c.id) }}" onsubmit="return confirm('Delete this comment?');">
                        <button class="btn btn-link" type="submit">Delete</button>
                    </form>
                {% endif %}
            </div>
        {% else %}
            <p>No comments yet. Start the conversation!</p>
        {% endfor %}
    </div>
</section>
{% endblock %}
